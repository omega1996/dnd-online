# Конфигурация CORS

## Текущая настройка

Сервер настроен для разрешения запросов с следующих доменов:

- `https://dnd.omegasoft.keenetic.name` - основной фронтенд домен
- `http://localhost` - для локальной разработки
- `http://localhost:80` - для локальной разработки
- `http://localhost:3000` - для локальной разработки
- `http://127.0.0.1:3000` - для локальной разработки

## Настройка через переменные окружения

Вы можете настроить разрешенные домены через переменную `CORS_ORIGINS` в файле `.env`:

```bash
CORS_ORIGINS=https://dnd.omegasoft.keenetic.name,http://localhost,http://localhost:80
```

Или в `docker-compose.yml`:

```yaml
environment:
  - CORS_ORIGINS=${CORS_ORIGINS:-https://dnd.omegasoft.keenetic.name,http://localhost}
```

## Что настроено

1. **HTTP API запросы** - CORS настроен для всех API endpoints
2. **WebSocket (Socket.io)** - CORS настроен для Socket.io соединений
3. **Статические файлы** - CORS заголовки добавлены для файлов в `/uploads/`

## Проверка

После настройки проверьте в браузере (F12 -> Console), что:

1. API запросы работают без ошибок CORS
2. Socket.io подключается успешно
3. Загруженные файлы доступны

## Режим разработки

В режиме разработки (`NODE_ENV !== 'production'`) разрешены запросы с любых доменов для удобства разработки.

## Troubleshooting

Если вы получаете ошибки CORS:

1. Убедитесь, что домен фронтенда указан в `CORS_ORIGINS`
2. Проверьте, что используется правильный протокол (http/https)
3. Убедитесь, что порт указан правильно (если используется нестандартный порт)
4. Перезапустите сервер после изменения переменных окружения
