# Доступ к загруженным файлам

## Как это работает

Загруженные файлы (изображения токенов, карт, персонажей) всегда доступны через относительные пути и проксируются через nginx, независимо от настройки `VITE_SERVER_URL`.

## Примеры URL

После загрузки файла сервер возвращает относительный путь, например:
```
/uploads/token-1767453685866-249699755.webp
```

Этот путь используется в клиенте как есть (относительный путь), и браузер запрашивает файл через nginx:
```
http://localhost/uploads/token-1767453685866-249699755.webp
```

Nginx проксирует этот запрос на бэкенд сервер:
```
http://server:3001/uploads/token-1767453685866-249699755.webp
```

## Преимущества

1. **Надежность** - файлы всегда доступны через nginx, даже если доменное имя сервера недоступно
2. **CORS** - не нужно настраивать CORS для файлов, так как они идут через тот же домен
3. **Кэширование** - nginx может кэшировать файлы для лучшей производительности
4. **Единообразие** - все файлы доступны одинаково, независимо от конфигурации

## Конфигурация

### Nginx (client/nginx.conf)
```nginx
location /uploads/ {
    proxy_pass http://server:3001/uploads/;
    # ... другие настройки
}
```

### Клиент (client/src/utils/api.js)
```javascript
export function buildAssetUrl(serverUrl, assetPath) {
  // Всегда используем относительные пути для файлов
  return assetPath.startsWith('/') ? assetPath : `/${assetPath}`;
}
```

### Сервер (server/src/index.js)
```javascript
app.use('/uploads', express.static(uploadsDir));
```

## Проверка

После загрузки файла проверьте в браузере (F12 -> Network), что запрос идет на:
- `http://localhost/uploads/...` (если клиент на localhost)
- Или на ваш домен клиента `/uploads/...`

Запрос должен успешно возвращать файл через nginx проксирование.
